<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Waste Matrix</title>
    
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="../libraries/p5.min.js"></script>
    <script src="matrix.js"></script>

    <link rel="icon" type="image/svg+xml" href="../favicon.svg">
  </head>

  <body>
    <!-- HEADER -->
    <header id="mainHeader">
      <div class="header-left">
        <button class="nav-btn" onclick="window.location.href='../index.html'">Home</button>
        <!--<button class="nav-btn" onclick="window.location.href='mainWithChart.html'">Chart</button>-->
        <a href="mainWithChart.html" class="nav-btn" onclick="clearP5Cache()">Chart</a>
      </div>
      
      <h1 class="site-title">Food Waste</h1>
      
      <div class="header-right">
        <button class="nav-btn" onclick="window.location.href='explanation.html'">Methodology</button>
        <button class="nav-btn" onclick="window.location.href='about.html'">About</button>
      </div>
    </header>

    <!--slider dell'anno-->
    <div id="sliderWrapper">
      <div id="sliderTrack">
          <div id="sliderLine"></div>
          <div id="tickContainer"></div>
          <div id="activeTick"></div>
      </div>

      <input type="range" id="yearSlider" min="2000" max="2023" value="2014">
      <div id="yearValue">2014</div>
    </div>

    <!-- Canvas per p5.js -->
    <div id="p5-container"></div>

    <script>
      function clearP5Cache() {
    // Forza il browser a ricaricare le risorse
    if(window.p5) {
        window.p5.remove();
    }
}

      function switchToChart() {
        alert("Chart view coming soon!");
      }

      // Funzione per inizializzare lo slider con i dati dal dataset
      function initializeSliderFromData(yearRange) {
        const yearSlider = document.getElementById("yearSlider");
        const yearValue = document.getElementById("yearValue");
        
        if (yearRange && yearSlider) {
          yearSlider.min = yearRange.min;
          yearSlider.max = yearRange.max;
          yearSlider.value = yearRange.max; // Imposta l'anno più recente
          yearValue.textContent = yearRange.max;
          updateActiveTick();
        }
      }

      function updateActiveTick() {
        const slider = document.getElementById("yearSlider");
        const activeTick = document.getElementById("activeTick");
        const track = document.getElementById("sliderTrack");

        if (!slider || !activeTick || !track) return;

        const min = parseInt(slider.min);
        const max = parseInt(slider.max);
        const value = parseInt(slider.value);
        const percent = (value - min) / (max - min);
        
        activeTick.style.left = (percent * 100) + "%";
      }

      // Inizializza lo slider quando la pagina è caricata
      document.addEventListener('DOMContentLoaded', function() {
        const yearSlider = document.getElementById("yearSlider");
        const sliderTrack = document.getElementById("sliderTrack");

        function updateSlider() {
          const min = parseInt(yearSlider.min);
          const max = parseInt(yearSlider.max);
          const value = parseInt(yearSlider.value);
          const percent = (value - min) / (max - min);
          
          activeTick.style.left = (percent * 100) + "%";
          yearValue.textContent = value;
        }

        // Click sul track
        sliderTrack.addEventListener("click", (e) => {
          const rect = sliderTrack.getBoundingClientRect();
          const percent = (e.clientX - rect.left) / rect.width;
          const min = parseInt(yearSlider.min);
          const max = parseInt(yearSlider.max);
          const newValue = min + Math.round(percent * (max - min));
          
          yearSlider.value = newValue;
          updateSlider();
        });

        // Input sullo slider
        yearSlider.addEventListener("input", updateSlider);

        // Inizializza
        updateSlider();
      });
    </script>
  </body>
</html>